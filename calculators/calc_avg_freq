#!/bin/bash -l
#===============================================================================
# Function      : calc_avg_freq
# Required files: FREQ (frequency data file from phonon run)
# Purpose       : Compute mean frequencies of each branch and overall average
# Child Function: uses embedded Python with numpy
# Default parameters: freq_file="FREQ"
# Run individually: calc_avg_freq [freq_file]
# Example usage  : calc_avg_freq FREQ
#                : calc_avg_freq FREQ_disp_20
# Last Update   : 2025-07-24
#===============================================================================

calc_avg_freq() {
    local freq_file="${1:-FREQ}"
    
    if [[ ! -f "$freq_file" ]]; then
        echo "Error: $freq_file not found!"
        return 1
    fi
    
    python3 << EOF
import numpy as np

try:
    data = np.loadtxt('$freq_file')
    if data.ndim == 1: 
        data = data.reshape(1, -1)
    
    freqs = data[:, 1:4]
    means = freqs.mean(axis=0)
    overall = means.mean()
    
    print(f"{'FILE':<25} {'FR1':>8} {'FR2':>8} {'FR3':>8} {'MEAN':>8}")
    print("-" * 57)
    print(f"{'$freq_file':<25} {means[0]:8.4f} {means[1]:8.4f} {means[2]:8.4f} {overall:8.4f}")
    
except Exception as e:
    print(f"Error processing $freq_file: {e}")
EOF
}
